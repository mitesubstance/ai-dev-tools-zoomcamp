openapi: 3.1.0
info:
  title: Collaborative Coding Interview Platform API
  description: |
    REST API for managing coding interview sessions with real-time collaboration.
    
    This API provides:
    - Session management (create, read, delete)
    - Health check endpoint
    - WebSocket endpoint for real-time collaboration
    
    **Note**: FastAPI auto-generates documentation at `/docs` (Swagger UI) and `/redoc` (ReDoc).
  version: 1.0.0
  contact:
    name: AI Dev Tools Zoomcamp - Week 2
    url: https://github.com/DataTalksClub/ai-dev-tools-zoomcamp

servers:
  - url: http://localhost:8000
    description: Local development server
  - url: https://your-app.onrender.com
    description: Production server (Render)

tags:
  - name: sessions
    description: Session management operations
  - name: health
    description: Health check and monitoring
  - name: websocket
    description: Real-time collaboration via WebSocket

paths:
  /health:
    get:
      summary: Health check
      description: Returns the health status of the API
      operationId: health_check
      tags:
        - health
      responses:
        '200':
          description: API is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                required:
                  - status

  /sessions:
    post:
      summary: Create a new coding session
      description: |
        Creates a new collaborative coding session and returns a unique session ID.
        The session ID can be used to join the session via `/session/{id}` URL.
      operationId: create_session
      tags:
        - sessions
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                language:
                  type: string
                  enum: [python, javascript]
                  default: python
                  description: Programming language for syntax highlighting
              example:
                language: python
      responses:
        '201':
          description: Session created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Session'
        '400':
          description: Invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /sessions/{session_id}:
    get:
      summary: Get session details
      description: Retrieves details about a specific coding session
      operationId: get_session
      tags:
        - sessions
      parameters:
        - name: session_id
          in: path
          required: true
          description: Unique session identifier (UUID)
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Session details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SessionDetails'
        '404':
          description: Session not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      summary: Delete a session
      description: Deletes a coding session and disconnects all users
      operationId: delete_session
      tags:
        - sessions
      parameters:
        - name: session_id
          in: path
          required: true
          description: Unique session identifier (UUID)
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Session deleted successfully
        '404':
          description: Session not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /ws/{session_id}:
    get:
      summary: WebSocket endpoint for real-time collaboration
      description: |
        Establishes a WebSocket connection for real-time collaborative editing.
        
        **Connection URL**: `ws://localhost:8000/ws/{session_id}?userId={uuid}&userName={name}`
        
        **Message Types**:
        
        **Client → Server**:
        - `join`: User joins session
        - `edit`: Code change from user (with CodeMirror ChangeSet)
        - `cursor`: Cursor position update
        
        **Server → Client**:
        - `sync`: Initial document state on join
        - `user_joined`: Notification when user joins
        - `user_left`: Notification when user leaves
        - `update`: Code update from another user
        
        **Note**: This is an async API endpoint. Swagger UI cannot test WebSocket connections.
      operationId: websocket_endpoint
      tags:
        - websocket
      parameters:
        - name: session_id
          in: path
          required: true
          description: Session ID to join
          schema:
            type: string
            format: uuid
        - name: userId
          in: query
          required: true
          description: Unique user identifier (UUID)
          schema:
            type: string
            format: uuid
        - name: userName
          in: query
          required: false
          description: Display name for the user
          schema:
            type: string
            example: Alice
      responses:
        '101':
          description: WebSocket connection established (Switching Protocols)
        '404':
          description: Session not found
        '400':
          description: Invalid query parameters

components:
  schemas:
    Session:
      type: object
      description: Basic session information returned on creation
      properties:
        id:
          type: string
          format: uuid
          description: Unique session identifier
          example: "550e8400-e29b-41d4-a716-446655440000"
        language:
          type: string
          enum: [python, javascript]
          description: Programming language for the session
          example: python
        createdAt:
          type: string
          format: date-time
          description: ISO 8601 timestamp of session creation
          example: "2025-12-08T21:00:00Z"
      required:
        - id
        - language
        - createdAt

    SessionDetails:
      type: object
      description: Detailed session information including users and document
      properties:
        id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
        language:
          type: string
          enum: [python, javascript]
          example: python
        createdAt:
          type: string
          format: date-time
          example: "2025-12-08T21:00:00Z"
        users:
          type: array
          description: List of currently connected users
          items:
            $ref: '#/components/schemas/User'
        document:
          $ref: '#/components/schemas/Document'
      required:
        - id
        - language
        - createdAt
        - users
        - document

    User:
      type: object
      description: User information
      properties:
        id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        name:
          type: string
          example: Alice
        color:
          type: string
          description: Hex color code for user's cursor
          example: "#FF5733"
      required:
        - id
        - name
        - color

    Document:
      type: object
      description: Document state
      properties:
        content:
          type: string
          description: Current code content
          example: "def fibonacci(n):\n    if n <= 1:\n        return n\n    return fibonacci(n-1) + fibonacci(n-2)"
        version:
          type: integer
          description: Document version number (for OT)
          example: 42
      required:
        - content
        - version

    Error:
      type: object
      description: Error response
      properties:
        detail:
          type: string
          description: Error message
          example: "Session not found"
      required:
        - detail

    # WebSocket Message Schemas (for documentation)
    WSMessage_Join:
      type: object
      description: Client → Server - User joins session
      properties:
        type:
          type: string
          enum: [join]
        sessionId:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        userName:
          type: string
      required:
        - type
        - sessionId
        - userId
      example:
        type: join
        sessionId: "550e8400-e29b-41d4-a716-446655440000"
        userId: "123e4567-e89b-12d3-a456-426614174000"
        userName: Alice

    WSMessage_Edit:
      type: object
      description: Client → Server - Code change
      properties:
        type:
          type: string
          enum: [edit]
        sessionId:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        changes:
          type: array
          description: CodeMirror ChangeSet
          items:
            type: object
        version:
          type: integer
      required:
        - type
        - sessionId
        - userId
        - changes
        - version
      example:
        type: edit
        sessionId: "550e8400-e29b-41d4-a716-446655440000"
        userId: "123e4567-e89b-12d3-a456-426614174000"
        changes: []
        version: 1

    WSMessage_Cursor:
      type: object
      description: Client → Server - Cursor position update
      properties:
        type:
          type: string
          enum: [cursor]
        sessionId:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        position:
          type: integer
          description: Cursor position in document
      required:
        - type
        - sessionId
        - userId
        - position
      example:
        type: cursor
        sessionId: "550e8400-e29b-41d4-a716-446655440000"
        userId: "123e4567-e89b-12d3-a456-426614174000"
        position: 42

    WSMessage_Sync:
      type: object
      description: Server → Client - Initial document state
      properties:
        type:
          type: string
          enum: [sync]
        version:
          type: integer
        content:
          type: string
      required:
        - type
        - version
        - content
      example:
        type: sync
        version: 0
        content: ""

    WSMessage_UserJoined:
      type: object
      description: Server → Client - User joined notification
      properties:
        type:
          type: string
          enum: [user_joined]
        userId:
          type: string
          format: uuid
        userName:
          type: string
      required:
        - type
        - userId
        - userName
      example:
        type: user_joined
        userId: "123e4567-e89b-12d3-a456-426614174000"
        userName: Alice

    WSMessage_UserLeft:
      type: object
      description: Server → Client - User left notification
      properties:
        type:
          type: string
          enum: [user_left]
        userId:
          type: string
          format: uuid
      required:
        - type
        - userId
      example:
        type: user_left
        userId: "123e4567-e89b-12d3-a456-426614174000"

    WSMessage_Update:
      type: object
      description: Server → Client - Code update from another user
      properties:
        type:
          type: string
          enum: [update]
        userId:
          type: string
          format: uuid
        changes:
          type: array
          description: CodeMirror ChangeSet
          items:
            type: object
        version:
          type: integer
      required:
        - type
        - userId
        - changes
        - version
      example:
        type: update
        userId: "123e4567-e89b-12d3-a456-426614174000"
        changes: []
        version: 2

security: []

externalDocs:
  description: AI Dev Tools Zoomcamp Course Materials
  url: https://github.com/DataTalksClub/ai-dev-tools-zoomcamp
